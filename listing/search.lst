     1                                  ;================================================
     2                                  
     3                                  section .text
     4                                  
     5                                  ;================================================
     6                                  
     7                                  global list_search_asm
     8                                  
     9                                  extern srtcmp
    10                                  
    11                                  ;================================================
    12                                  
    13                                  ; rax, rcx, rdx, rsi, rdi, r8, r9, r10, r11
    14                                  
    15                                  ; entry: rdi = list
    16                                  ;        rsi = elem
    17                                  
    18                                  list_search_asm:
    19                                  
    20 00000000 4883FF00                        cmp rdi, 0                      ; if list == NULL
    21 00000004 7508                            jne .skip1                      ; return -1;
    22                                  
    23 00000006 48C7C0FFFFFFFF                  mov rax, -1
    24 0000000D C3                              ret
    25                                  
    26                                      .skip1:
    27 0000000E 837F3000                        cmp dword [rdi + 48], 0         ; if size of list is 0
    28 00000012 7445                            je .ret_not_found               ; then return -2;
    29                                  
    30 00000014 8B4F30                          mov ecx, dword [rdi + 48]      ; max ct = list->size
    31 00000017 448B4718                        mov r8d, dword [rdi + 24]      ; r8 = list->head = cur_index
    32                                  
    33 0000001B 4D31C9                          xor r9, r9                      ; counter
    34                                  
    35                                      .loop:
    36 0000001E 4939C9                          cmp r9, rcx                     ; if ct >= max ct
    37 00000021 7D36                            jge .ret_not_found              ; stop
    38                                  
    39 00000023 49FFC1                          inc r9                          ; inc ct
    40                                  
    41 00000026 4989F2                          mov r10, rsi                    ; r10 = const char* elem
    42                                  
    43 00000029 4C8B1F                          mov r11, [rdi]
    44 0000002C 4F8B1CC3                        mov r11, [r11 + 8 * r8]         ; r11 = const char* data
    45                                  
    46                                      .strcmp_loop:
    47 00000030 418A12                          mov byte dl, [r10]
    48 00000033 418A03                          mov byte al, [r11]              ; load values
    49                                  
    50 00000036 49FFC2                          inc r10
    51 00000039 49FFC3                          inc r11                         ; to next symb
    52                                  
    53 0000003C 80FA00                          cmp dl, 0                       ; if first reached end
    54 0000003F 7406                            je .strcmp_stop                 ; jmp to check 2nd
    55                                  
    56 00000041 38C2                            cmp dl, al                      ; compare bytes
    57 00000043 74EB                            je .strcmp_loop                 ; if equal, repeat
    58                                  
    59 00000045 EB04                            jmp .next_iter                  ; else next iteration of compare
    60                                  
    61                                      .strcmp_stop:               
    62 00000047 3C00                            cmp al ,0                       ; if 2nd is not equal 1st
    63 00000049 740A                            je .ret_found                   ; iterate to next compare
    64                                  
    65                                      .next_iter:
    66 0000004B 4C8B5708                        mov r10,       [rdi + 8]        ; r10 = list->next
    67 0000004F 478B0482                        mov r8d, dword [r10 + 4 * r8]   ; r8 = list->next[cur_index]
    68                                  
    69 00000053 EBC9                            jmp .loop
    70                                      .ret_found:
    71 00000055 4C89C0                          mov rax, r8
    72 00000058 C3                              ret 
    73                                      
    74                                      .ret_not_found:
    75 00000059 48C7C0FEFFFFFF                  mov rax, -2
    76 00000060 C3                              ret 
    77                                  
    78                                  ;================================================ 
